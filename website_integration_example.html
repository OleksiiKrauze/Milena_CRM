<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Ñ–æ—Ä–º–∏ –∑ CRM - –ü—Ä–∏–∫–ª–∞–¥</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
        }
        .code-box {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 20px 0;
        }
        pre {
            margin: 0;
            font-size: 14px;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>üìã –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Ñ–æ—Ä–º–∏ –∑ CRM MilenaCRM</h1>

        <div class="info-box">
            <h3>‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
            <p>–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –º—ñ—Å—Ç–∏—Ç—å –ø—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó —Ñ–æ—Ä–º–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ—à—É–∫ –ª—é–¥–∏–Ω–∏ –∑ –≤–∞—à–æ–≥–æ —Å–∞–π—Ç—É –≤ CRM —Å–∏—Å—Ç–µ–º—É.</p>
        </div>

        <h2>1. API Endpoint</h2>
        <div class="code-box">
            <pre>POST https://crm.przmilena.click/api/public/cases</pre>
        </div>

        <h2>2. –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (Headers)</h2>
        <div class="code-box">
<pre>Content-Type: application/json
X-API-Key: YOUR_API_KEY_HERE (–æ–ø—Ü—ñ–π–Ω–æ, —è–∫—â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ)</pre>
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è –£–≤–∞–≥–∞:</strong> –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ API –∫–ª—é—á –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó –±–µ–∑–ø–µ–∫–∏, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–º—ñ–Ω–Ω—É –æ—Ç–æ—á–µ–Ω–Ω—è <code>PUBLIC_API_KEY</code> –≤ —Ñ–∞–π–ª—ñ <code>.env.production</code> –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.
        </div>

        <h2>3. –ü—Ä–∏–∫–ª–∞–¥ JavaScript –∫–æ–¥—É</h2>
        <div class="code-box">
<pre><code>// –ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º–∏ –≤ CRM
async function submitCaseToAPI(formData) {
    const API_URL = 'https://crm.przmilena.click/api/public/cases';

    // –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON
    const caseData = {
        // –û–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è
        applicant_full_name: formData.applicantFullName,  // –ü–Ü–ë –∑–∞—è–≤–Ω–∏–∫–∞
        applicant_phone: formData.applicantPhone,          // –¢–µ–ª–µ—Ñ–æ–Ω –∑–∞—è–≤–Ω–∏–∫–∞
        missing_full_name: formData.missingFullName,       // –ü–Ü–ë –∑–Ω–∏–∫–ª–æ–≥–æ

        // –û–ø—Ü—ñ–π–Ω—ñ –ø–æ–ª—è
        subject: formData.subject,                         // –¢–µ–º–∞
        applicant_relation: formData.applicantRelation,    // –ö–∏–º –¥–æ–≤–æ–¥–∏—Ç—å—Å—è
        missing_gender: formData.missingGender,            // –°—Ç–∞—Ç—å (–ß–æ–ª–æ–≤—ñ—á–∞/–ñ—ñ–Ω–æ—á–∞)
        missing_birthdate: formData.missingBirthdate,      // –î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è (YYYY-MM-DD)
        missing_region: formData.missingRegion,            // –û–±–ª–∞—Å—Ç—å –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
        additional_search_regions: formData.additionalRegions, // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –æ–±–ª–∞—Å—Ç—ñ (—á–µ—Ä–µ–∑ –∫–æ–º—É)
        missing_phone: formData.missingPhone,              // –¢–µ–ª–µ—Ñ–æ–Ω –∑–Ω–∏–∫–ª–æ–≥–æ
        missing_settlement: formData.missingSettlement,    // –ú—ñ—Å—Ü–µ–≤—ñ—Å—Ç—å –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
        missing_last_seen_date: formData.lastSeenDate,     // –î–∞—Ç–∞ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è (YYYY-MM-DD)
        missing_last_seen_time: formData.lastSeenTime,     // –ß–∞—Å –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è (HH:MM)
        police_report_info: formData.policeReport,         // –ó–∞—è–≤–∞ –≤ –ø–æ–ª—ñ—Ü—ñ—é
        search_terrain_type: formData.terrainType,         // –¢–∏–ø –º—ñ—Å—Ü–µ–≤–æ—Å—Ç—ñ (–ú—ñ—Å—Ç–æ/–õ—ñ—Å)
        disappearance_circumstances: formData.circumstances, // –û–±—Å—Ç–∞–≤–∏–Ω–∏ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
        missing_diseases: formData.healthCondition,        // –°—Ç–∞–Ω –∑–¥–æ—Ä–æ–≤'—è
        missing_clothing: formData.clothing,               // –û–¥—è–≥
        missing_special_signs: formData.specialSigns,      // –û—Å–æ–±–ª–∏–≤—ñ –ø—Ä–∏–∫–º–µ—Ç–∏
        missing_belongings: formData.belongings,           // –†–µ—á—ñ –ø—Ä–∏ —Å–æ–±—ñ
        missing_photos: formData.photos || [],             // –ú–∞—Å–∏–≤ URLs —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π
        additional_info: formData.additionalInfo           // –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
    };

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫, —è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è API –∫–ª—é—á:
                // 'X-API-Key': 'YOUR_API_KEY_HERE'
            },
            body: JSON.stringify(caseData)
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞—è–≤–∫–∏');
        }

        const result = await response.json();

        if (result.success) {
            console.log('–ó–∞—è–≤–∫–∞ —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∞, ID:', result.case_id);
            alert(result.message);
            return result;
        }

    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        alert('–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞—è–≤–∫–∏. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.');
        throw error;
    }
}

// –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ Contact Form 7 (WordPress)
document.addEventListener('wpcf7mailsent', function(event) {
    // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ —Ñ–æ—Ä–º–∏ Contact Form 7
    const formData = {
        applicantFullName: event.detail.inputs.find(i => i.name === 'applicant-name')?.value,
        applicantPhone: event.detail.inputs.find(i => i.name === 'applicant-phone')?.value,
        missingFullName: event.detail.inputs.find(i => i.name === 'missing-name')?.value,
        applicantRelation: event.detail.inputs.find(i => i.name === 'applicant-relation')?.value,
        missingGender: event.detail.inputs.find(i => i.name === 'missing-gender')?.value,
        missingBirthdate: event.detail.inputs.find(i => i.name === 'missing-birthdate')?.value,
        missingRegion: event.detail.inputs.find(i => i.name === 'missing-region')?.value,
        additionalRegions: event.detail.inputs.find(i => i.name === 'additional-regions')?.value,
        missingPhone: event.detail.inputs.find(i => i.name === 'missing-phone')?.value,
        missingSettlement: event.detail.inputs.find(i => i.name === 'missing-settlement')?.value,
        lastSeenDate: event.detail.inputs.find(i => i.name === 'last-seen-date')?.value,
        lastSeenTime: event.detail.inputs.find(i => i.name === 'last-seen-time')?.value,
        policeReport: event.detail.inputs.find(i => i.name === 'police-report')?.value,
        terrainType: event.detail.inputs.find(i => i.name === 'terrain-type')?.value,
        circumstances: event.detail.inputs.find(i => i.name === 'circumstances')?.value,
        healthCondition: event.detail.inputs.find(i => i.name === 'health-condition')?.value,
        clothing: event.detail.inputs.find(i => i.name === 'clothing')?.value,
        specialSigns: event.detail.inputs.find(i => i.name === 'special-signs')?.value,
        belongings: event.detail.inputs.find(i => i.name === 'belongings')?.value,
        additionalInfo: event.detail.inputs.find(i => i.name === 'additional-info')?.value,
        subject: event.detail.inputs.find(i => i.name === 'subject')?.value
    };

    // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –¥–∞–Ω—ñ –≤ CRM
    submitCaseToAPI(formData);
}, false);
</code></pre>
        </div>

        <h2>4. –§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API</h2>

        <h3>–£—Å–ø—ñ—à–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (201 Created):</h3>
        <div class="code-box">
<pre>{
  "success": true,
  "message": "–ó–∞—è–≤–∫—É —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ. –ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.",
  "case_id": 123
}</pre>
        </div>

        <h3>–ü–æ–º–∏–ª–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó (400 Bad Request):</h3>
        <div class="code-box">
<pre>{
  "detail": "–ü–æ–º–∏–ª–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö: ..."
}</pre>
        </div>

        <h3>–ü–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è –ª—ñ–º—ñ—Ç—É –∑–∞–ø–∏—Ç—ñ–≤ (429 Too Many Requests):</h3>
        <div class="code-box">
<pre>{
  "detail": {
    "error": "Rate limit exceeded",
    "message": "Too many requests. Please try again later.",
    "remaining": 0,
    "window_seconds": 60
  }
}</pre>
        </div>

        <h2>5. –û–±–º–µ–∂–µ–Ω–Ω—è (Rate Limiting)</h2>
        <div class="info-box">
            <p><strong>–õ—ñ–º—ñ—Ç:</strong> 5 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ 60 —Å–µ–∫—É–Ω–¥ –∑ –æ–¥–Ω–æ–≥–æ IP –∞–¥—Ä–µ—Å–∏</p>
            <p>–¶–µ –∑–∞—Ö–∏—â–∞—î API –≤—ñ–¥ —Å–ø–∞–º—É —Ç–∞ –∑–ª–æ–≤–∂–∏–≤–∞–Ω—å.</p>
        </div>

        <h2>6. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ Production</h2>

        <h3>6.1. –î–æ–¥–∞–π—Ç–µ –≤ —Ñ–∞–π–ª .env.production (–æ–ø—Ü—ñ–π–Ω–æ):</h3>
        <div class="code-box">
<pre># –û–ø—Ü—ñ–π–Ω–∏–π API –∫–ª—é—á –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó –±–µ–∑–ø–µ–∫–∏ –ø—É–±–ª—ñ—á–Ω–∏—Ö endpoints
PUBLIC_API_KEY=your-secret-api-key-here

# CORS –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–≤–∂–µ –¥–æ–¥–∞–Ω–æ milena.in.ua)
CORS_ORIGINS=http://localhost:5173,https://milena.in.ua,http://milena.in.ua,https://crm.przmilena.click</pre>
        </div>

        <h3>6.2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:</h3>
        <div class="code-box">
<pre>cd ~/MilenaCRM
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production down
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production up -d --build</pre>
        </div>

        <h2>7. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è API</h2>

        <h3>–¢–µ—Å—Ç —á–µ—Ä–µ–∑ curl:</h3>
        <div class="code-box">
<pre>curl -X POST https://crm.przmilena.click/api/public/cases \
  -H "Content-Type: application/json" \
  -d '{
    "applicant_full_name": "–Ü–≤–∞–Ω–æ–≤ –Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤–∏—á",
    "applicant_phone": "+380501234567",
    "missing_full_name": "–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä–æ –ü–µ—Ç—Ä–æ–≤–∏—á",
    "applicant_relation": "–ë—Ä–∞—Ç",
    "missing_gender": "–ß–æ–ª–æ–≤—ñ—á–∞",
    "missing_region": "–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å",
    "disappearance_circumstances": "–ü—ñ—à–æ–≤ –∑ –¥–æ–º—É —ñ –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–≤—Å—è"
  }'</pre>
        </div>

        <h2>8. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–∞—è–≤–æ–∫ –≤ CRM</h2>
        <div class="info-box">
            <p>–í—Å—ñ –∑–∞—è–≤–∫–∏ –∑ —Å–∞–π—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å –≤ CRM –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º <strong>"–ù–æ–≤–∞ –∑ —Å–∞–π—Ç—É"</strong> —Ç–∞ —Ç–µ–≥–æ–º <strong>"–ó–∞—è–≤–∫–∞ –∑ —Å–∞–π—Ç—É"</strong>.</p>
            <p>–í–∏ –º–æ–∂–µ—Ç–µ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ —Ç–∞–∫—ñ –∑–∞—è–≤–∫–∏ –≤ —Å–ø–∏—Å–∫—É –∫–µ–π—Å—ñ–≤ –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º.</p>
        </div>

        <div class="warning">
            <h3>üîí –ë–µ–∑–ø–µ–∫–∞</h3>
            <ul>
                <li>API –∑–∞—Ö–∏—â–µ–Ω–æ rate limiting (5 –∑–∞–ø–∏—Ç—ñ–≤ –∑–∞ 60 —Å–µ–∫—É–Ω–¥ –∑ IP)</li>
                <li>CORS –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ —Ç—ñ–ª—å–∫–∏ –¥–ª—è milena.in.ua</li>
                <li>–ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ API –∫–ª—é—á –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó –±–µ–∑–ø–µ–∫–∏</li>
                <li>–í—Å—ñ –ø–æ–º–∏–ª–∫–∏ –ª–æ–≥—É—é—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ</li>
            </ul>
        </div>
    </div>
</body>
</html>
