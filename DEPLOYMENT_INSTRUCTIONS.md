# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é: –í–∏–¥–µ–æ + –ß–µ–∫–±–æ–∫—Å-—Ç–µ–≥–∏

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –¥–ª—è –ø—Ä–æ–ø–∞–≤—à–∏—Ö (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Ñ–æ—Ç–æ)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 100 –ú–ë
- –§–æ—Ä–º–∞—Ç—ã: MP4, MOV, AVI, MKV, WebM
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –≤ CaseDetailsPage —Å HTML5 video player
- –ü–æ–ª–µ `videos` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É `missing_persons`

### 2. –ß–µ–∫–±–æ–∫—Å-—Ç–µ–≥–∏ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
- 15 —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤ (—É–∫—Ä–∞–∏–Ω—Å–∫–∏–π)
- UI: –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã –≤ –æ–¥–Ω—É –∫–æ–ª–æ–Ω–∫—É
- Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ whitelist
- –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ: –≤–æ–∑—Ä–∞—Å—Ç –≤—Å–µ–≥–¥–∞, –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —è–≤–Ω–æ —É–ø–æ–º—è–Ω—É—Ç–æ

## üìã –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### Backend
- `backend/app/models/missing_person.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `videos`
- `backend/app/schemas/missing_person.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Ö–µ–º—ã API
- `backend/app/routers/upload.py` - —É–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç –¥–æ 100MB
- `backend/app/services/openai_service.py` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–≥–æ–≤
- `backend/alembic/versions/007_add_videos_to_missing_persons.py` - –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

### Frontend
- `frontend/src/types/api.ts` - –¥–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `videos`
- `frontend/src/constants/tags.ts` - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
- `frontend/src/components/TagsCheckboxGroup.tsx` - –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `frontend/src/components/MissingPersonBlock.tsx` - –±–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
- `frontend/src/pages/CaseDetailsPage.tsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–µ–æ
- `frontend/src/pages/CreateCasePage.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤
- `frontend/src/pages/EditCasePage.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `docker-compose.yml` - –¥–æ–±–∞–≤–ª–µ–Ω volume –¥–ª—è alembic –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Production

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
git status

# –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
git add .
git commit -m "Add videos field to missing persons and predefined tags checkboxes"
git push origin main
```

### –®–∞–≥ 2: –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh ubuntu@<server-ip>

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd ~/MilenaCRM

# –ü–æ–ª—É—á–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ frontend (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
cd frontend
npm ci
npm run build
cd ..

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production down
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production build --no-cache
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production up -d

# –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production exec backend alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∞—Å—å
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production exec backend alembic current
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: 007_add_videos (head)
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Nginx (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ nginx —Ä–∞–∑—Ä–µ—à–µ–Ω —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ 100MB:

```bash
sudo nano /etc/nginx/sites-available/crm.przmilena.click

# –î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ:
server {
    ...
    client_max_body_size 100M;
    ...
}

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ nginx
sudo nginx -t
sudo systemctl reload nginx
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –ë–î

**–í–ê–ñ–ù–û:** –ü—Ä–æ–º–ø—Ç –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production exec db psql -U milena_user -d milenacrm

# –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ–º–ø—Ç (—Å–º. —Ñ–∞–π–ª UPDATED_AUTOFILL_PROMPT.md –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞)
# –í—Å—Ç–∞–≤—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª –ø—Ä–æ —Ç–µ–≥–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–º–ø—Ç

# –í—ã—Ö–æ–¥ –∏–∑ psql
\q
```

–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `UPDATED_AUTOFILL_PROMPT.md`.

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://crm.przmilena.click
2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ (–¥–æ 100MB)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ–∫–±–æ–∫—Å-—Ç–µ–≥–∏
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å —Ç–µ–≥–∞–º–∏
6. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞—è–≤–∫–∏ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∏–¥–µ–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°—Ç–∞—Ä—ã–µ –∑–∞—è–≤–∫–∏ –±–µ–∑ –ø–æ–ª—è `videos` –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤)
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–≥–æ–≤**: Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–µ–≥–∏ –ø–æ whitelist –∏–∑ 15 –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö
3. **Nginx**: –ù–∞ production –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `client_max_body_size 100M;`
4. **Frontend build**: –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–π—Ç–µ frontend –ø–æ—Å–ª–µ pull –∏–∑–º–µ–Ω–µ–Ω–∏–π!

## üîÑ –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production exec backend alembic downgrade -1

# –û—Ç–∫–∞—Ç –∫–æ–¥–∞
git reset --hard <previous-commit-hash>
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production build --no-cache
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production up -d
```

## üìù –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–ø–∞–≤—à–µ–≥–æ
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å 1-2 —Ñ–æ—Ç–æ
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å 1 –≤–∏–¥–µ–æ (5-10 –ú–ë)
5. –í—ã–±—Ä–∞—Ç—å 2-3 —Ç–µ–≥–∞ –∏–∑ —á–µ–∫–±–æ–∫—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–î–æ—Ä–æ—Å–ª–∏–π 18-60", "–ü—Ä–æ–±–ª–µ–º–∏ –∑ –ø–∞–º'—è—Ç—Ç—é")
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
7. –û—Ç–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
8. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤–∏–¥–µ–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è
9. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–µ–≥–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: 413 Request Entity Too Large
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `client_max_body_size` –≤ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –í–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å MP4, MOV, AVI, MKV, WebM)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä (–º–∞–∫—Å 100 –ú–ë)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend: `sudo docker-compose -f docker-compose.prod.yml --env-file .env.production logs backend --tail 50`

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ–≥–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–æ–º–ø—Ç –≤ –ë–î –æ–±–Ω–æ–≤–ª–µ–Ω (—Å–º. UPDATED_AUTOFILL_PROMPT.md)

### –ü—Ä–æ–±–ª–µ–º–∞: Migration failed
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ë–î:
```bash
sudo docker-compose -f docker-compose.prod.yml --env-file .env.production exec backend alembic current
```
